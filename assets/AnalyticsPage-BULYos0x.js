import{j as e,c as se}from"./index-BQZntsDD.js";import{a as n,q as ne,l as S,j as k,s as w,t as ae,u as R,v as O}from"./react-icons-B0pCOPMl.js";import{R as p,A as K,C as f,X as b,Y as x,T as u,L as P,a as _,b as B,d as C,B as oe,e as G}from"./charts-CH763x3z.js";import"./viz-libs-DMcWW7AE.js";const c=`${se.API_URL}/api`;function de(){const[a,m]=n.useState([]),[r,y]=n.useState([]),[i,L]=n.useState(null),[W,j]=n.useState(!0),[d,$]=n.useState("experiment"),[h,H]=n.useState(null),[D,Y]=n.useState([]),[E,M]=n.useState([]),[F,U]=n.useState([]),[V,I]=n.useState(!1);n.useEffect(()=>{(async()=>{try{const s=await(await fetch(`${c}/experiment/sessions`)).json();if(y(s),s.length>0&&!i){const l=s.find(N=>N.is_current)||s[0];L(l.filename)}else s.length===0&&j(!1)}catch(o){console.error("Failed to fetch sessions",o),j(!1)}})()},[]),n.useEffect(()=>{if(!i)return;const t=async()=>{j(!0);try{const l=await(await fetch(`${c}/experiment/stats?limit=1000&filename=${i}`)).json();m(l)}catch(s){console.error("Failed to fetch stats",s)}finally{j(!1)}};if(t(),r.find(s=>s.filename===i)?.is_current){const s=setInterval(t,5e3);return()=>clearInterval(s)}},[i,r]),n.useEffect(()=>{if(d!=="learning")return;const t=async()=>{I(!0);try{const[s,l,N,J]=await Promise.all([fetch(`${c}/learning/stats`),fetch(`${c}/learning/insights`),fetch(`${c}/learning/policy-history`),fetch(`${c}/learning/accuracy-over-time`)]),Q=await s.json(),Z=await l.json(),ee=await N.json(),te=await J.json();H(Q),Y(Z.insights||[]),M(ee.history||[]),U(te.periods||[])}catch(s){console.error("Failed to fetch learning data",s)}finally{I(!1)}};t();const o=setInterval(t,1e4);return()=>clearInterval(o)},[d]);const T=a[a.length-1]||{},z=T.revenue_cum||0,v=T.expenses_cum||0,X=v>0?((z-v)/v*100).toFixed(1):"0.0",q=r.find(t=>t.filename===i);return e.jsxs("div",{className:"min-h-screen bg-stone-950 text-stone-200 font-sans p-6 overflow-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between mb-6 border-b border-stone-800 pb-4 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-cyan-900/30 rounded flex items-center justify-center text-cyan-400 border border-cyan-800",children:e.jsx(ne,{})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-stone-100 tracking-tight",children:"DATA & ANALYTICS"}),e.jsxs("p",{className:"text-[10px] text-stone-500 font-mono uppercase tracking-wider flex items-center gap-2",children:[e.jsx("span",{children:"GEMINI-3 INTELLIGENT FACTORY"}),q?.is_current&&e.jsx("span",{className:"text-emerald-500 animate-pulse",children:"● LIVE"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>$("experiment"),className:`flex items-center gap-2 px-4 py-2 rounded text-sm font-semibold transition ${d==="experiment"?"bg-cyan-600 text-white":"bg-stone-800 text-stone-400 hover:bg-stone-700"}`,children:[e.jsx(S,{})," Experiment"]}),e.jsxs("button",{onClick:()=>$("learning"),className:`flex items-center gap-2 px-4 py-2 rounded text-sm font-semibold transition ${d==="learning"?"bg-purple-600 text-white":"bg-stone-800 text-stone-400 hover:bg-stone-700"}`,children:[e.jsx(k,{})," System Learning"]})]})]}),d==="experiment"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-stone-900 border border-stone-800 rounded px-2 py-1",children:[e.jsx(w,{className:"text-stone-500 text-xs"}),e.jsx("select",{value:i||"",onChange:t=>L(t.target.value),className:"bg-transparent text-xs text-stone-300 outline-none border-none py-1",children:r.map(t=>e.jsxs("option",{value:t.filename,className:"bg-stone-900",children:[t.created_at.split("T")[0]," ",t.created_at.split("T")[1].split(".")[0]," ",t.is_current?"(Current)":""]},t.filename))})]}),e.jsx(A,{label:"ROI (Est.)",value:`${X}%`,color:"text-emerald-400"}),e.jsx(A,{label:"Revenue",value:`$${z.toLocaleString()}`,color:"text-stone-200"}),e.jsx(A,{label:"Agent Cycles",value:a.length.toString(),color:"text-stone-400"}),e.jsxs("a",{href:`${c}/experiment/download?filename=${i}`,target:"_blank",className:"flex items-center gap-2 bg-stone-800 hover:bg-stone-700 text-stone-300 px-4 py-2 rounded text-sm font-semibold border border-stone-700 transition",download:!0,children:[e.jsx(ae,{})," CSV"]})]}),W&&a.length===0?e.jsxs("div",{className:"h-[400px] w-full flex items-center justify-center text-stone-500 gap-2 border border-stone-800 border-dashed rounded bg-stone-900/20",children:[e.jsx(R,{className:"animate-spin"})," Loading Session Data..."]}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-stone-900 border border-stone-800 rounded p-4 h-[350px]",children:[e.jsx("h3",{className:"text-sm font-bold text-stone-400 mb-4 font-mono uppercase",children:"Financial Performance (Cumulative)"}),e.jsx(p,{width:"100%",height:"90%",children:e.jsxs(K,{data:a,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"colorRev",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorExp",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#ef4444",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#ef4444",stopOpacity:0})]})]}),e.jsx(f,{strokeDasharray:"3 3",stroke:"#292524"}),e.jsx(b,{dataKey:"sim_time_hours",stroke:"#57534e",tick:{fontSize:10},label:{value:"Sim Hours",position:"insideBottom",offset:-5}}),e.jsx(x,{stroke:"#57534e",tick:{fontSize:10}}),e.jsx(u,{contentStyle:{backgroundColor:"#1c1917",borderColor:"#44403c",fontSize:"12px"}}),e.jsx(P,{}),e.jsx(_,{type:"monotone",dataKey:"revenue_cum",name:"Revenue",stroke:"#10b981",fillOpacity:1,fill:"url(#colorRev)"}),e.jsx(_,{type:"monotone",dataKey:"expenses_cum",name:"Expenses",stroke:"#ef4444",fillOpacity:1,fill:"url(#colorExp)"})]})})]}),e.jsxs("div",{className:"bg-stone-900 border border-stone-800 rounded p-4 h-[350px]",children:[e.jsx("h3",{className:"text-sm font-bold text-stone-400 mb-4 font-mono uppercase",children:"Operational Efficiency vs Safety"}),e.jsx(p,{width:"100%",height:"90%",children:e.jsxs(B,{data:a,children:[e.jsx(f,{strokeDasharray:"3 3",stroke:"#292524"}),e.jsx(b,{dataKey:"sim_time_hours",stroke:"#57534e",tick:{fontSize:10}}),e.jsx(x,{yAxisId:"left",stroke:"#f59e0b",domain:[0,1],tick:{fontSize:10}}),e.jsx(x,{yAxisId:"right",orientation:"right",stroke:"#3b82f6",domain:[80,100],tick:{fontSize:10}}),e.jsx(u,{contentStyle:{backgroundColor:"#1c1917",borderColor:"#44403c",fontSize:"12px"}}),e.jsx(P,{}),e.jsx(C,{yAxisId:"left",type:"monotone",dataKey:"oee",name:"OEE",stroke:"#f59e0b",dot:!1,strokeWidth:2}),e.jsx(C,{yAxisId:"right",type:"stepAfter",dataKey:"safety_score",name:"Safety Score",stroke:"#3b82f6",dot:!1,strokeWidth:2})]})})]}),e.jsxs("div",{className:"bg-stone-900 border border-stone-800 rounded p-4 h-[300px]",children:[e.jsx("h3",{className:"text-sm font-bold text-stone-400 mb-4 font-mono uppercase",children:"System Stability (Active Alerts)"}),e.jsx(p,{width:"100%",height:"90%",children:e.jsxs(oe,{data:a,children:[e.jsx(f,{strokeDasharray:"3 3",stroke:"#292524",vertical:!1}),e.jsx(b,{dataKey:"sim_time_hours",stroke:"#57534e",tick:{fontSize:10}}),e.jsx(x,{stroke:"#57534e",tick:{fontSize:10}}),e.jsx(u,{contentStyle:{backgroundColor:"#1c1917",borderColor:"#44403c",fontSize:"12px"}}),e.jsx(G,{dataKey:"active_alerts",name:"Active Alerts",fill:"#d97706"}),e.jsx(G,{dataKey:"safety_incidents",name:"Safety Incidents",fill:"#ef4444"})]})})]}),e.jsxs("div",{className:"bg-stone-900 border border-stone-800 rounded p-4 h-[300px]",children:[e.jsx("h3",{className:"text-sm font-bold text-stone-400 mb-4 font-mono uppercase",children:"Est. Agent Compute Cost ($)"}),e.jsx(p,{width:"100%",height:"90%",children:e.jsxs(K,{data:a,children:[e.jsx(f,{strokeDasharray:"3 3",stroke:"#292524"}),e.jsx(b,{dataKey:"sim_time_hours",stroke:"#57534e",tick:{fontSize:10}}),e.jsx(x,{stroke:"#57534e",tick:{fontSize:10}}),e.jsx(u,{contentStyle:{backgroundColor:"#1c1917",borderColor:"#44403c",fontSize:"12px"}}),e.jsx(_,{type:"monotone",dataKey:"agent_cost_est",name:"Agent Cost ($)",stroke:"#8b5cf6",fill:"#8b5cf6",fillOpacity:.2})]})})]})]})]}),d==="learning"&&e.jsx(e.Fragment,{children:V&&!h?e.jsxs("div",{className:"h-[400px] w-full flex items-center justify-center text-stone-500 gap-2 border border-stone-800 border-dashed rounded bg-stone-900/20",children:[e.jsx(R,{className:"animate-spin"})," Loading Learning Data..."]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(g,{icon:e.jsx(k,{}),label:"Total Decisions",value:h?.total_replays||0,color:"bg-purple-900/30 border-purple-800 text-purple-400"}),e.jsx(g,{icon:e.jsx(O,{}),label:"Decision Accuracy",value:`${((h?.accuracy_rate||0)*100).toFixed(1)}%`,color:"bg-emerald-900/30 border-emerald-800 text-emerald-400"}),e.jsx(g,{icon:e.jsx(S,{}),label:"Optimal Decisions",value:h?.optimal_decisions||0,color:"bg-cyan-900/30 border-cyan-800 text-cyan-400"}),e.jsx(g,{icon:e.jsx(w,{}),label:"Policy Updates Pending",value:h?.policy_updates_recommended||0,color:"bg-amber-900/30 border-amber-800 text-amber-400"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-stone-900 border border-stone-800 rounded p-4 h-[350px]",children:[e.jsxs("h3",{className:"text-sm font-bold text-stone-400 mb-4 font-mono uppercase flex items-center gap-2",children:[e.jsx(S,{className:"text-purple-400"})," Accuracy Over Time"]}),F.length>0?e.jsx(p,{width:"100%",height:"85%",children:e.jsxs(B,{data:F,children:[e.jsx(f,{strokeDasharray:"3 3",stroke:"#292524"}),e.jsx(b,{dataKey:"cumulative_total",stroke:"#57534e",tick:{fontSize:10},label:{value:"Total Decisions",position:"insideBottom",offset:-5}}),e.jsx(x,{stroke:"#57534e",tick:{fontSize:10},domain:[0,1],tickFormatter:t=>`${(t*100).toFixed(0)}%`}),e.jsx(u,{contentStyle:{backgroundColor:"#1c1917",borderColor:"#44403c",fontSize:"12px"},formatter:t=>[`${(t*100).toFixed(1)}%`,"Accuracy"]}),e.jsx(C,{type:"monotone",dataKey:"accuracy",name:"Accuracy",stroke:"#a855f7",strokeWidth:3,dot:{fill:"#a855f7",strokeWidth:2}})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-stone-500 text-sm",children:"No learning data yet. Run the simulation to start learning."})]}),e.jsxs("div",{className:"bg-stone-900 border border-stone-800 rounded p-4 h-[350px] overflow-hidden flex flex-col",children:[e.jsxs("h3",{className:"text-sm font-bold text-stone-400 mb-4 font-mono uppercase flex items-center gap-2",children:[e.jsx(O,{className:"text-amber-400"})," Strategic Insights Learned"]}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-2",children:D.length>0?D.slice().reverse().map((t,o)=>e.jsxs("div",{className:`p-3 rounded border ${t.was_optimal?"bg-emerald-950/30 border-emerald-900":"bg-amber-950/30 border-amber-900"}`,children:[e.jsx("p",{className:"text-sm text-stone-200",children:t.insight}),e.jsxs("p",{className:"text-[10px] text-stone-500 mt-1 font-mono",children:[t.incident_id," • ",new Date(t.created_at).toLocaleString()]})]},o)):e.jsx("div",{className:"h-full flex items-center justify-center text-stone-500 text-sm",children:"No insights yet. The system learns from counterfactual analysis after each decision."})})]})]}),e.jsxs("div",{className:"bg-stone-900 border border-stone-800 rounded p-6 mb-6",children:[e.jsxs("h3",{className:"text-sm font-bold text-stone-400 mb-6 font-mono uppercase flex items-center gap-2",children:[e.jsx(w,{className:"text-cyan-400"})," Policy Evolution Timeline"]}),E.length>0?e.jsx("div",{className:"relative border-l-2 border-stone-800 ml-3 space-y-8 pb-4",children:E.slice().reverse().map((t,o)=>e.jsxs("div",{className:"relative pl-8",children:[e.jsx("div",{className:`absolute -left-[9px] top-0 w-4 h-4 rounded-full border-2 ${o===0?"bg-cyan-500 border-cyan-900 shadow-[0_0_10px_rgba(6,182,212,0.5)]":"bg-stone-800 border-stone-600"}`}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded textxs font-bold font-mono ${o===0?"bg-cyan-900/40 text-cyan-300":"bg-stone-800 text-stone-400"}`,children:t.version}),e.jsx("span",{className:"text-xs text-stone-500 font-mono",children:new Date(t.created_at).toLocaleString()})]}),e.jsx("p",{className:"text-stone-300 font-medium mb-2",children:t.description}),t.changes&&t.changes.length>0&&e.jsx("div",{className:"space-y-1",children:t.changes.map((s,l)=>e.jsxs("div",{className:"flex items-start gap-2 text-sm text-stone-400",children:[e.jsx("span",{className:"text-emerald-500 mt-1",children:"●"}),e.jsx("span",{children:s})]},l))})]}),e.jsxs("div",{className:"bg-stone-950/50 p-3 rounded border border-stone-800/50 max-w-sm",children:[e.jsx("p",{className:"text-[10px] text-stone-500 uppercase font-bold mb-1",children:"Trigger Event"}),e.jsxs("p",{className:"text-xs text-stone-400 italic",children:['"',t.trigger_event,'"']})]})]})]},o))}):e.jsxs("div",{className:"h-32 flex items-center justify-center text-stone-500 text-sm border border-stone-800 border-dashed rounded",children:["System is running on initial baseline policy (v1.0).",e.jsx("br",{}),"Policy updates occur automatically when decision accuracy drops below threshold."]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-purple-950/50 to-stone-900 border border-purple-900/50 rounded p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-purple-300 mb-2 flex items-center gap-2",children:[e.jsx(k,{})," How Gemini 3 Learns Over Time"]}),e.jsxs("p",{className:"text-sm text-stone-400 leading-relaxed",children:["After each decision, the system performs a ",e.jsx("strong",{className:"text-stone-200",children:"counterfactual analysis"}),': "What if we had chosen the second-best hypothesis?" These insights are stored persistently and',e.jsx("strong",{className:"text-stone-200",children:" injected into future reasoning prompts"}),", allowing Gemini 3 to improve its decision-making over time. When enough suboptimal decisions accumulate, the system triggers ",e.jsx("strong",{className:"text-purple-300",children:"policy evolution"})," to automatically adjust its confidence thresholds and framework weights."]})]})]})})]})}const A=({label:a,value:m,color:r})=>e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-[10px] text-stone-500 font-mono uppercase",children:a}),e.jsx("span",{className:`text-lg font-bold font-mono tracking-tight ${r}`,children:m})]}),g=({icon:a,label:m,value:r,color:y})=>e.jsxs("div",{className:`${y} border rounded p-4 flex items-center gap-3`,children:[e.jsx("div",{className:"text-2xl",children:a}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-stone-400 font-mono uppercase",children:m}),e.jsx("p",{className:"text-xl font-bold",children:r})]})]});export{de as default};
