import{j as e}from"./index-HzuaP5gO.js";import{a,o as Q,l as N,j as S,p as k,q as Z,s as $,t as z}from"./react-icons-B-Va5VYq.js";import{R as h,C as p,X as f,Y as d,T as b,L as O,a as R,b as w}from"./charts-CqbVGCMY.js";import"./viz-libs-C1cYOpPs.js";function ne(){const[n,x]=a.useState([]),[r,g]=a.useState([]),[i,_]=a.useState(null),[K,u]=a.useState(!0),[c,A]=a.useState("experiment"),[m,P]=a.useState(null),[L,G]=a.useState([]),[D,B]=a.useState([]),[F,W]=a.useState([]),[H,E]=a.useState(!1);a.useEffect(()=>{(async()=>{try{const s=await(await fetch("http://localhost:8000/api/experiment/sessions")).json();if(g(s),s.length>0&&!i){const l=s.find(v=>v.is_current)||s[0];_(l.filename)}else s.length===0&&u(!1)}catch(o){console.error("Failed to fetch sessions",o),u(!1)}})()},[]),a.useEffect(()=>{if(!i)return;const t=async()=>{u(!0);try{const l=await(await fetch(`http://localhost:8000/api/experiment/stats?limit=1000&filename=${i}`)).json();x(l)}catch(s){console.error("Failed to fetch stats",s)}finally{u(!1)}};if(t(),r.find(s=>s.filename===i)?.is_current){const s=setInterval(t,5e3);return()=>clearInterval(s)}},[i,r]),a.useEffect(()=>{if(c!=="learning")return;const t=async()=>{E(!0);try{const[s,l,v,V]=await Promise.all([fetch("http://localhost:8000/api/learning/stats"),fetch("http://localhost:8000/api/learning/insights"),fetch("http://localhost:8000/api/learning/policy-history"),fetch("http://localhost:8000/api/learning/accuracy-over-time")]),X=await s.json(),q=await l.json(),U=await v.json(),J=await V.json();P(X),G(q.insights||[]),B(U.history||[]),W(J.periods||[])}catch(s){console.error("Failed to fetch learning data",s)}finally{E(!1)}};t();const o=setInterval(t,1e4);return()=>clearInterval(o)},[c]);const T=n[n.length-1]||{},I=T.revenue_cum||0,y=T.expenses_cum||0,Y=y>0?((I-y)/y*100).toFixed(1):"0.0",M=r.find(t=>t.filename===i);return e.jsxs("div",{className:"min-h-screen bg-stone-950 text-stone-200 font-sans p-6 overflow-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between mb-6 border-b border-stone-800 pb-4 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-cyan-900/30 rounded flex items-center justify-center text-cyan-400 border border-cyan-800",children:e.jsx(Q,{})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-stone-100 tracking-tight",children:"DATA & ANALYTICS"}),e.jsxs("p",{className:"text-[10px] text-stone-500 font-mono uppercase tracking-wider flex items-center gap-2",children:[e.jsx("span",{children:"GEMINI-3 INTELLIGENT FACTORY"}),M?.is_current&&e.jsx("span",{className:"text-emerald-500 animate-pulse",children:"● LIVE"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>A("experiment"),className:`flex items-center gap-2 px-4 py-2 rounded text-sm font-semibold transition ${c==="experiment"?"bg-cyan-600 text-white":"bg-stone-800 text-stone-400 hover:bg-stone-700"}`,children:[e.jsx(N,{})," Experiment"]}),e.jsxs("button",{onClick:()=>A("learning"),className:`flex items-center gap-2 px-4 py-2 rounded text-sm font-semibold transition ${c==="learning"?"bg-purple-600 text-white":"bg-stone-800 text-stone-400 hover:bg-stone-700"}`,children:[e.jsx(S,{})," System Learning"]})]})]}),c==="experiment"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-stone-900 border border-stone-800 rounded px-2 py-1",children:[e.jsx(k,{className:"text-stone-500 text-xs"}),e.jsx("select",{value:i||"",onChange:t=>_(t.target.value),className:"bg-transparent text-xs text-stone-300 outline-none border-none py-1",children:r.map(t=>e.jsxs("option",{value:t.filename,className:"bg-stone-900",children:[t.created_at.split("T")[0]," ",t.created_at.split("T")[1].split(".")[0]," ",t.is_current?"(Current)":""]},t.filename))})]}),e.jsx(C,{label:"ROI (Est.)",value:`${Y}%`,color:"text-emerald-400"}),e.jsx(C,{label:"Revenue",value:`$${I.toLocaleString()}`,color:"text-stone-200"}),e.jsx(C,{label:"Agent Cycles",value:n.length.toString(),color:"text-stone-400"}),e.jsxs("a",{href:`http://localhost:8000/api/experiment/download?filename=${i}`,target:"_blank",className:"flex items-center gap-2 bg-stone-800 hover:bg-stone-700 text-stone-300 px-4 py-2 rounded text-sm font-semibold border border-stone-700 transition",download:!0,children:[e.jsx(Z,{})," CSV"]})]}),K&&n.length===0?e.jsxs("div",{className:"h-[400px] w-full flex items-center justify-center text-stone-500 gap-2 border border-stone-800 border-dashed rounded bg-stone-900/20",children:[e.jsx($,{className:"animate-spin"})," Loading Session Data..."]}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-stone-900 border border-stone-800 rounded p-4 h-[350px]",children:[e.jsx("h3",{className:"text-sm font-bold text-stone-400 mb-4 font-mono uppercase",children:"Financial Performance (Cumulative)"}),e.jsx(h,{width:"100%",height:"90%",children:e.jsxs(AreaChart,{data:n,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"colorRev",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorExp",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#ef4444",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#ef4444",stopOpacity:0})]})]}),e.jsx(p,{strokeDasharray:"3 3",stroke:"#292524"}),e.jsx(f,{dataKey:"sim_time_hours",stroke:"#57534e",tick:{fontSize:10},label:{value:"Sim Hours",position:"insideBottom",offset:-5}}),e.jsx(d,{stroke:"#57534e",tick:{fontSize:10}}),e.jsx(b,{contentStyle:{backgroundColor:"#1c1917",borderColor:"#44403c",fontSize:"12px"}}),e.jsx(O,{}),e.jsx(Area,{type:"monotone",dataKey:"revenue_cum",name:"Revenue",stroke:"#10b981",fillOpacity:1,fill:"url(#colorRev)"}),e.jsx(Area,{type:"monotone",dataKey:"expenses_cum",name:"Expenses",stroke:"#ef4444",fillOpacity:1,fill:"url(#colorExp)"})]})})]}),e.jsxs("div",{className:"bg-stone-900 border border-stone-800 rounded p-4 h-[350px]",children:[e.jsx("h3",{className:"text-sm font-bold text-stone-400 mb-4 font-mono uppercase",children:"Operational Efficiency vs Safety"}),e.jsx(h,{width:"100%",height:"90%",children:e.jsxs(R,{data:n,children:[e.jsx(p,{strokeDasharray:"3 3",stroke:"#292524"}),e.jsx(f,{dataKey:"sim_time_hours",stroke:"#57534e",tick:{fontSize:10}}),e.jsx(d,{yAxisId:"left",stroke:"#f59e0b",domain:[0,1],tick:{fontSize:10}}),e.jsx(d,{yAxisId:"right",orientation:"right",stroke:"#3b82f6",domain:[80,100],tick:{fontSize:10}}),e.jsx(b,{contentStyle:{backgroundColor:"#1c1917",borderColor:"#44403c",fontSize:"12px"}}),e.jsx(O,{}),e.jsx(w,{yAxisId:"left",type:"monotone",dataKey:"oee",name:"OEE",stroke:"#f59e0b",dot:!1,strokeWidth:2}),e.jsx(w,{yAxisId:"right",type:"stepAfter",dataKey:"safety_score",name:"Safety Score",stroke:"#3b82f6",dot:!1,strokeWidth:2})]})})]}),e.jsxs("div",{className:"bg-stone-900 border border-stone-800 rounded p-4 h-[300px]",children:[e.jsx("h3",{className:"text-sm font-bold text-stone-400 mb-4 font-mono uppercase",children:"System Stability (Active Alerts)"}),e.jsx(h,{width:"100%",height:"90%",children:e.jsxs(BarChart,{data:n,children:[e.jsx(p,{strokeDasharray:"3 3",stroke:"#292524",vertical:!1}),e.jsx(f,{dataKey:"sim_time_hours",stroke:"#57534e",tick:{fontSize:10}}),e.jsx(d,{stroke:"#57534e",tick:{fontSize:10}}),e.jsx(b,{contentStyle:{backgroundColor:"#1c1917",borderColor:"#44403c",fontSize:"12px"}}),e.jsx(Bar,{dataKey:"active_alerts",name:"Active Alerts",fill:"#d97706"}),e.jsx(Bar,{dataKey:"safety_incidents",name:"Safety Incidents",fill:"#ef4444"})]})})]}),e.jsxs("div",{className:"bg-stone-900 border border-stone-800 rounded p-4 h-[300px]",children:[e.jsx("h3",{className:"text-sm font-bold text-stone-400 mb-4 font-mono uppercase",children:"Est. Agent Compute Cost ($)"}),e.jsx(h,{width:"100%",height:"90%",children:e.jsxs(AreaChart,{data:n,children:[e.jsx(p,{strokeDasharray:"3 3",stroke:"#292524"}),e.jsx(f,{dataKey:"sim_time_hours",stroke:"#57534e",tick:{fontSize:10}}),e.jsx(d,{stroke:"#57534e",tick:{fontSize:10}}),e.jsx(b,{contentStyle:{backgroundColor:"#1c1917",borderColor:"#44403c",fontSize:"12px"}}),e.jsx(Area,{type:"monotone",dataKey:"agent_cost_est",name:"Agent Cost ($)",stroke:"#8b5cf6",fill:"#8b5cf6",fillOpacity:.2})]})})]})]})]}),c==="learning"&&e.jsx(e.Fragment,{children:H&&!m?e.jsxs("div",{className:"h-[400px] w-full flex items-center justify-center text-stone-500 gap-2 border border-stone-800 border-dashed rounded bg-stone-900/20",children:[e.jsx($,{className:"animate-spin"})," Loading Learning Data..."]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(j,{icon:e.jsx(S,{}),label:"Total Decisions",value:m?.total_replays||0,color:"bg-purple-900/30 border-purple-800 text-purple-400"}),e.jsx(j,{icon:e.jsx(z,{}),label:"Decision Accuracy",value:`${((m?.accuracy_rate||0)*100).toFixed(1)}%`,color:"bg-emerald-900/30 border-emerald-800 text-emerald-400"}),e.jsx(j,{icon:e.jsx(N,{}),label:"Optimal Decisions",value:m?.optimal_decisions||0,color:"bg-cyan-900/30 border-cyan-800 text-cyan-400"}),e.jsx(j,{icon:e.jsx(k,{}),label:"Policy Updates Pending",value:m?.policy_updates_recommended||0,color:"bg-amber-900/30 border-amber-800 text-amber-400"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-stone-900 border border-stone-800 rounded p-4 h-[350px]",children:[e.jsxs("h3",{className:"text-sm font-bold text-stone-400 mb-4 font-mono uppercase flex items-center gap-2",children:[e.jsx(N,{className:"text-purple-400"})," Accuracy Over Time"]}),F.length>0?e.jsx(h,{width:"100%",height:"85%",children:e.jsxs(R,{data:F,children:[e.jsx(p,{strokeDasharray:"3 3",stroke:"#292524"}),e.jsx(f,{dataKey:"cumulative_total",stroke:"#57534e",tick:{fontSize:10},label:{value:"Total Decisions",position:"insideBottom",offset:-5}}),e.jsx(d,{stroke:"#57534e",tick:{fontSize:10},domain:[0,1],tickFormatter:t=>`${(t*100).toFixed(0)}%`}),e.jsx(b,{contentStyle:{backgroundColor:"#1c1917",borderColor:"#44403c",fontSize:"12px"},formatter:t=>[`${(t*100).toFixed(1)}%`,"Accuracy"]}),e.jsx(w,{type:"monotone",dataKey:"accuracy",name:"Accuracy",stroke:"#a855f7",strokeWidth:3,dot:{fill:"#a855f7",strokeWidth:2}})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-stone-500 text-sm",children:"No learning data yet. Run the simulation to start learning."})]}),e.jsxs("div",{className:"bg-stone-900 border border-stone-800 rounded p-4 h-[350px] overflow-hidden flex flex-col",children:[e.jsxs("h3",{className:"text-sm font-bold text-stone-400 mb-4 font-mono uppercase flex items-center gap-2",children:[e.jsx(z,{className:"text-amber-400"})," Strategic Insights Learned"]}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-2",children:L.length>0?L.slice().reverse().map((t,o)=>e.jsxs("div",{className:`p-3 rounded border ${t.was_optimal?"bg-emerald-950/30 border-emerald-900":"bg-amber-950/30 border-amber-900"}`,children:[e.jsx("p",{className:"text-sm text-stone-200",children:t.insight}),e.jsxs("p",{className:"text-[10px] text-stone-500 mt-1 font-mono",children:[t.incident_id," • ",new Date(t.created_at).toLocaleString()]})]},o)):e.jsx("div",{className:"h-full flex items-center justify-center text-stone-500 text-sm",children:"No insights yet. The system learns from counterfactual analysis after each decision."})})]})]}),e.jsxs("div",{className:"bg-stone-900 border border-stone-800 rounded p-6 mb-6",children:[e.jsxs("h3",{className:"text-sm font-bold text-stone-400 mb-6 font-mono uppercase flex items-center gap-2",children:[e.jsx(k,{className:"text-cyan-400"})," Policy Evolution Timeline"]}),D.length>0?e.jsx("div",{className:"relative border-l-2 border-stone-800 ml-3 space-y-8 pb-4",children:D.slice().reverse().map((t,o)=>e.jsxs("div",{className:"relative pl-8",children:[e.jsx("div",{className:`absolute -left-[9px] top-0 w-4 h-4 rounded-full border-2 ${o===0?"bg-cyan-500 border-cyan-900 shadow-[0_0_10px_rgba(6,182,212,0.5)]":"bg-stone-800 border-stone-600"}`}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded textxs font-bold font-mono ${o===0?"bg-cyan-900/40 text-cyan-300":"bg-stone-800 text-stone-400"}`,children:t.version}),e.jsx("span",{className:"text-xs text-stone-500 font-mono",children:new Date(t.created_at).toLocaleString()})]}),e.jsx("p",{className:"text-stone-300 font-medium mb-2",children:t.description}),t.changes&&t.changes.length>0&&e.jsx("div",{className:"space-y-1",children:t.changes.map((s,l)=>e.jsxs("div",{className:"flex items-start gap-2 text-sm text-stone-400",children:[e.jsx("span",{className:"text-emerald-500 mt-1",children:"●"}),e.jsx("span",{children:s})]},l))})]}),e.jsxs("div",{className:"bg-stone-950/50 p-3 rounded border border-stone-800/50 max-w-sm",children:[e.jsx("p",{className:"text-[10px] text-stone-500 uppercase font-bold mb-1",children:"Trigger Event"}),e.jsxs("p",{className:"text-xs text-stone-400 italic",children:['"',t.trigger_event,'"']})]})]})]},o))}):e.jsxs("div",{className:"h-32 flex items-center justify-center text-stone-500 text-sm border border-stone-800 border-dashed rounded",children:["System is running on initial baseline policy (v1.0).",e.jsx("br",{}),"Policy updates occur automatically when decision accuracy drops below threshold."]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-purple-950/50 to-stone-900 border border-purple-900/50 rounded p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-purple-300 mb-2 flex items-center gap-2",children:[e.jsx(S,{})," How Gemini 3 Learns Over Time"]}),e.jsxs("p",{className:"text-sm text-stone-400 leading-relaxed",children:["After each decision, the system performs a ",e.jsx("strong",{className:"text-stone-200",children:"counterfactual analysis"}),': "What if we had chosen the second-best hypothesis?" These insights are stored persistently and',e.jsx("strong",{className:"text-stone-200",children:" injected into future reasoning prompts"}),", allowing Gemini 3 to improve its decision-making over time. When enough suboptimal decisions accumulate, the system triggers ",e.jsx("strong",{className:"text-purple-300",children:"policy evolution"})," to automatically adjust its confidence thresholds and framework weights."]})]})]})})]})}const C=({label:n,value:x,color:r})=>e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-[10px] text-stone-500 font-mono uppercase",children:n}),e.jsx("span",{className:`text-lg font-bold font-mono tracking-tight ${r}`,children:x})]}),j=({icon:n,label:x,value:r,color:g})=>e.jsxs("div",{className:`${g} border rounded p-4 flex items-center gap-3`,children:[e.jsx("div",{className:"text-2xl",children:n}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-stone-400 font-mono uppercase",children:x}),e.jsx("p",{className:"text-xl font-bold",children:r})]})]});export{ne as default};
